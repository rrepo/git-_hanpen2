{"filter":false,"title":"scraping.rb","tooltip":"/mooovi/app/models/scraping.rb","undoManager":{"mark":8,"position":8,"stack":[[{"start":{"row":0,"column":0},"end":{"row":10,"column":3},"action":"insert","lines":["class Scraping","  def self.movie_urls","    puts 'get movies link URL'","    # ここに処理を書く","  end","","  def self.get_product(link)","    puts 'get movie information'","    # ここに処理を書く","  end","end"],"id":1}],[{"start":{"row":0,"column":0},"end":{"row":10,"column":3},"action":"remove","lines":["class Scraping","  def self.movie_urls","    puts 'get movies link URL'","    # ここに処理を書く","  end","","  def self.get_product(link)","    puts 'get movie information'","    # ここに処理を書く","  end","end"],"id":2},{"start":{"row":0,"column":0},"end":{"row":24,"column":3},"action":"insert","lines":["class Scraping","  def self.movie_urls","    links = []","    agent = Mechanize.new","    current_page = agent.get(\"http://review-movie.herokuapp.com/\")","    elements = current_page.search('.entry-title a')","    elements.each do |ele|","      links << ele.get_attribute('href')","    end","","    links.each do |link|","      get_product('http://review-movie.herokuapp.com/' + link)","    end","  end","","  def self.get_product(link)","    agent = Mechanize.new","    page = agent.get(link)","    title = page.at('.entry-title').inner_text","    image_url = page.at('.entry-content img')[:src] if page.at('.entry-content img')","","    product = Product.new(title: title, image_url: image_url)","    product.save","  end","end"]}],[{"start":{"row":20,"column":0},"end":{"row":20,"column":2},"action":"insert","lines":["  "],"id":3}],[{"start":{"row":20,"column":2},"end":{"row":20,"column":4},"action":"insert","lines":["  "],"id":4}],[{"start":{"row":20,"column":4},"end":{"row":20,"column":83},"action":"insert","lines":["product = Product.where(title: title, image_url: image_url).first_or_initialize"],"id":5}],[{"start":{"row":20,"column":5},"end":{"row":20,"column":83},"action":"remove","lines":["roduct = Product.where(title: title, image_url: image_url).first_or_initialize"],"id":6},{"start":{"row":20,"column":5},"end":{"row":20,"column":84},"action":"insert","lines":["product = Product.where(title: title, image_url: image_url).first_or_initialize"]}],[{"start":{"row":0,"column":14},"end":{"row":1,"column":0},"action":"insert","lines":["",""],"id":7},{"start":{"row":1,"column":0},"end":{"row":1,"column":2},"action":"insert","lines":["  "]}],[{"start":{"row":1,"column":2},"end":{"row":20,"column":5},"action":"insert","lines":["links = []","    agent = Mechanize.new","    next_url = \"\"","","    while true","      current_page = agent.get(\"http://review-movie.herokuapp.com\" + next_url)","      elements = current_page.search('.entry-title a')","      elements.each do |ele|","        links << ele.get_attribute('href')","      end","","      next_link = current_page.at('.pagination .next a')","      break unless next_link","      next_url = next_link.get_attribute('href')","","    end","    links.each do |link|","      get_product('http://review-movie.herokuapp.com' + link)","    end","  end"],"id":8}],[{"start":{"row":0,"column":0},"end":{"row":44,"column":3},"action":"remove","lines":["class Scraping","  links = []","    agent = Mechanize.new","    next_url = \"\"","","    while true","      current_page = agent.get(\"http://review-movie.herokuapp.com\" + next_url)","      elements = current_page.search('.entry-title a')","      elements.each do |ele|","        links << ele.get_attribute('href')","      end","","      next_link = current_page.at('.pagination .next a')","      break unless next_link","      next_url = next_link.get_attribute('href')","","    end","    links.each do |link|","      get_product('http://review-movie.herokuapp.com' + link)","    end","  end","  def self.movie_urls","    links = []","    agent = Mechanize.new","    current_page = agent.get(\"http://review-movie.herokuapp.com/\")","    elements = current_page.search('.entry-title a')","    elements.each do |ele|","      links << ele.get_attribute('href')","    end","","    links.each do |link|","      get_product('http://review-movie.herokuapp.com/' + link)","    end","  end","","  def self.get_product(link)","    agent = Mechanize.new","    page = agent.get(link)","    title = page.at('.entry-title').inner_text","    image_url = page.at('.entry-content img')[:src] if page.at('.entry-content img')","    pproduct = Product.where(title: title, image_url: image_url).first_or_initialize","    product = Product.new(title: title, image_url: image_url)","    product.save","  end","end"],"id":9},{"start":{"row":0,"column":0},"end":{"row":40,"column":3},"action":"insert","lines":["class Scraping","  def self.movie_urls","    agent = Mechanize.new","    links = []","    next_url = \"\"","","    while true","      current_page = agent.get(\"http://review-movie.herokuapp.com\" + next_url)","      elements = current_page.search('.entry-title a')","      elements.each do |ele|","        links << ele.get_attribute('href')","      end","","      next_link = current_page.at('.pagination .next a')","      break unless next_link","      next_url = next_link.get_attribute('href')","","    end","    links.each do |link|","      get_product('http://review-movie.herokuapp.com' + link)","    end","  end","","  def self.get_product(link)","    agent = Mechanize.new","    page = agent.get(link)","    title = page.at('.entry-title').inner_text if page.at('.entry-title')","","    image_url = page.at('.entry-content img')[:src] if page.at('.entry-content img')","    director = page.at('.director span').inner_text if page.at('.director span')","    detail = page.at('.entry-content p').inner_text if page.at('.entry-content p')","    open_date = page.at('.date span').inner_text if page.at('.date span')","","    product = Product.where(title: title).first_or_initialize","    product.image_url = image_url","    product.director = director","    product.detail = detail","    product.open_date = open_date","    product.save","  end","end"]}]]},"ace":{"folds":[],"scrolltop":262,"scrollleft":0,"selection":{"start":{"row":40,"column":3},"end":{"row":40,"column":3},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":15,"state":"start","mode":"ace/mode/ruby"}},"timestamp":1536739287795,"hash":"1a0279c72c509fe6ae28a223d6827b59db647036"}